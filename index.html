<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Sudoku - Classique</title>
    <style>
        /* --- VARIABLES --- */
        /* --- VARIABLES --- */
        /* --- VARIABLES --- */
        :root {
            --neon-pink: #FF0099;
            --neon-blue: #00E0FF; 
            --neon-green: #00FF00;
            --main-text-color: #FFFFFF;
            
            /* COULEURS DES BORDURES DE GRILLE (RESTENT BLEU/JAUNE) */
            --grid-main-border-color: var(--neon-blue);
            --grid-minor-border-color: #EEFC00; 
            --grid-background: #000000;

            /* COULEURS DES CELLULES */
            --cell-bg-color: #CCE3E3; 
            --fixed-cell-bg: #111111; 
            --cell-text-color: #FFFFFF; 
            --cell-fixed-text-color: #AAAAAA; 
            
            /* NOUVELLE COULEUR DE S√âLECTION EN BLEU TR√àS CLAIR */
            --cell-selected-bg: rgba(180, 250, 255, 0.4); 
            
            --cell-error-bg: rgba(244, 67, 54, 0.6); 
            
            --keypad-bg: rgba(255, 255, 255, 0.1);
        }

        /* --- STYLES G√âN√âRAUX --- */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #000000;
            color: var(--main-text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            /* L'image de fond reste retir√©e pour √©viter le blocage 404 */
        }

        /* --- CONTENEURS D'√âCRAN --- */
        #start-screen, #game-screen {
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 0 40px var(--neon-blue);
            text-align: center;
            max-width: 600px;
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #game-screen {
            display: none; /* Cach√© par d√©faut */
        }

        /* --- TITRE --- */
        h1 {
            font-size: 3em;
            text-shadow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green);
            margin-bottom: 20px;
            border-bottom: 3px solid var(--neon-green);
            padding-bottom: 10px;
        }

        /* --- BOUTONS --- */
        .btn {
            padding: 15px 30px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            max-width: 300px;
        }

        .btn:hover:not(:disabled) {
            transform: scale(1.05);
        }
        
        /* Styles de couleur pour les boutons de difficult√© */
        .btn-easy {
            background-color: var(--neon-green);
            color: #000000;
            box-shadow: 0 0 10px var(--neon-green);
        }

        .btn-medium {
            background-color: var(--neon-pink);
            color: #FFFFFF;
            box-shadow: 0 0 10px var(--neon-pink);
        }

        .btn-hard {
            background-color: #FF0000;
            color: #FFFFFF;
            box-shadow: 0 0 10px #FF0000;
        }
        
        .btn-continue {
            display: none; /* G√©r√© par JS */
            background-color: #FFC300;
            color: #333333;
            box-shadow: 0 0 10px #FFC300;
        }

        /* --- AFFICHAGE STATISTIQUES ET CONTR√îLES --- */
        #stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: bold;
        }

        #controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 500px;
            margin-top: 20px;
        }
        
        #btn-hint, #btn-home, #btn-facebook {
            padding: 10px 15px;
            font-size: 1em;
            margin: 5px;
            border-radius: 8px;
            transition: opacity 0.3s;
        }
        
        #btn-hint {
            background-color: var(--neon-blue);
            color: #FFFFFF;
            box-shadow: 0 0 8px var(--neon-blue);
        }

        #btn-home {
            background-color: #555555;
            color: #FFFFFF;
        }
        
        #btn-facebook {
            background-color: #1877F2;
            color: white;
            margin-top: 20px;
            width: 90%;
            max-width: 400px;
        }


        /* --- GRILLE SUDOKU (MISE √Ä JOUR) --- */
        #board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 1px;
            background: var(--grid-background); /* FOND NOIR ENTRE LES CELLULES */
            border: 3px solid var(--grid-main-border-color); /* Bordure ext√©rieure en BLEU */
            
            width: 100%;
            aspect-ratio: 1; 
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            
            /* EFFET NEON SUR LA GRILLE (BLEU) */
            box-shadow: 0 0 15px var(--grid-main-border-color); 
        }

        .cell {
            background: var(--cell-bg-color);
            color: var(--cell-text-color); /* Texte en Blanc */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        .cell.fixed {
            background: var(--fixed-cell-bg); /* Fond Gris fonc√© */
            color: var(--cell-fixed-text-color); /* Texte Gris clair */
            cursor: default;
            font-weight: bold;
        }

        .cell.selected {
            background: var(--cell-selected-bg) !important; /* Fond Bleu tr√®s clair */
            box-shadow: 0 0 8px var(--neon-blue); /* Petite lueur BLEUE */
        }
        
        .cell.error {
            background: var(--cell-error-bg) !important;
            animation: shake 0.5s;
        }

        /* Lignes des grandes sous-grilles (3x3) - MAINTENANT EN BLEU √âLECTRIQUE */
        .cell:nth-child(3n) { border-right: 3px solid var(--grid-main-border-color); }
        .cell:nth-child(9n) { border-right: none; }
        .cell:nth-child(n+19):nth-child(-n+27), 
        .cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 3px solid var(--grid-main-border-color); }
        
        /* Lignes fines int√©rieures (1x1) - MAINTENANT EN JAUNE FLUO */
        .cell { border-bottom: 1px solid var(--grid-minor-border-color); }
        .cell:nth-child(n+73) { border-bottom: none; } /* Enl√®ve la derni√®re ligne horizontale */
        .cell:nth-child(9n) { border-right: none !important; } /* S'assurer que le bord droit est bien supprim√© */
        .cell:nth-child(n):not(:nth-child(3n)) { border-right: 1px solid var(--grid-minor-border-color); } /* Petites lignes verticales */


        /* --- CLAVIER (Keypad) --- */
        #keypad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 500px;
            padding: 10px 0;
        }

        .key {
            background: var(--keypad-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 1.8rem;
            padding: 10px 0;
            cursor: pointer;
            text-align: center;
            transition: background 0.1s, transform 0.1s;
        }

        .key:hover:not(.completed) {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        .key.completed {
            background-color: rgba(0, 255, 0, 0.1); 
            color: rgba(255, 255, 255, 0.5); 
            opacity: 0.6;
            cursor: default;
        }
        
        /* Bouton de suppression */
        .key.delete {
            background-color: #555555;
            color: #FFFFFF;
            font-size: 1em;
            line-height: 1.4;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- MODALE (Fin de Partie) --- */
        #modal {
            display: none; 
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.95);
            margin: 15% auto;
            padding: 40px;
            border-radius: 15px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 0 30px var(--neon-pink);
            animation: fadeIn 0.5s;
        }

        #modal-title {
            font-size: 2em;
            color: var(--neon-pink);
            margin-bottom: 10px;
            text-shadow: 0 0 5px var(--neon-pink);
        }

        #modal-msg {
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        /* --- ANIMATIONS --- */
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        @keyframes victoryGlow {
            0% { box-shadow: 0 0 10px var(--neon-green); }
            50% { box-shadow: 0 0 40px var(--neon-green); }
            100% { box-shadow: 0 0 10px var(--neon-green); }
        }

        .victory-animation {
            animation: victoryGlow 1.5s infinite alternate;
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1>Emoji Sudoku De Totof üß©</h1>
        
        <button id="btn-continue" class="btn btn-medium btn-continue" onclick="continueGame()">Continuer la partie</button>
        
        <p>Choisis ton niveau pour commencer :</p>

        <button class="btn btn-easy" onclick="startGame('easy')">Facile (D√©butant)</button>
        <button class="btn btn-medium" onclick="startGame('medium')">Moyen (Habitu√©)</button>
        <button class="btn btn-hard" onclick="startGame('hard')">Difficile (Expert)</button>
        
        <p style="margin-top: 25px; font-size: 0.9em;">Cr√©√© par ChezTotof</p>
    </div>

    <div id="game-screen">
        <div id="stats">
            <span id="mistakes">Erreurs: 0/3</span>
            <span id="hints">Indice: 0/3</span>
        </div>
        
        <div id="board">
            </div>
        
        <div id="keypad">
            <div class="key delete" onclick="inputNumber(0)">Effacer</div>
        </div>

        <div id="controls">
            <button id="btn-hint" class="btn" onclick="useHint()">Indice üí°</button>
            <button id="btn-home" class="btn" onclick="goToStartScreen()">Accueil üè†</button>
        </div>
        
        <button id="btn-facebook" class="btn" onclick="shareOnFacebook()">
            <span style="font-size: 1.1em;">f</span> Partager sur Facebook
        </button>
    </div>

    <div id="modal">
        <div class="modal-content">
            <h2 id="modal-title"></h2>
            <p id="modal-msg"></p>
            <button class="btn btn-easy" onclick="goToStartScreen()">Retour √† l'accueil</button>
        </div>
    </div>


<script>
    // --- Configuration & Variables ---
    const emojis = ['üçã', '‚òï', 'üçè', 'üßä', 'üçü', 'ü•ë', 'üçá', 'üçî', 'üçë'];
    let solution = [];
    let initialBoard = [];
    let currentBoard = [];
    let mistakes = 0;
    const maxMistakes = 3;
    let hintsUsed = 0;
    const maxHints = 3; 
    let selectedCellIndex = -1;
    let gameOver = false;
    const SAVE_KEY = 'emojiSudokuSave';
    

    // --- G√©n√©rateur de Nombre Pseudo-Al√©atoire D√©termin√© (Seed) ---
    function seededRandom(seed) {
        let x = Math.sin(seed++) * 10000;
        return x - Math.floor(x);
    }
    
    // --- V√©rification de sauvegarde au d√©marrage ---
    window.onload = function() {
        if (localStorage.getItem(SAVE_KEY)) {
            document.getElementById('btn-continue').style.display = 'block';
        }
    };

    // --- Logique Sudoku (G√©n√©ration) ---
    function isValid(board, row, col, num) {
        for (let x = 0; x < 9; x++) if (board[row][x] === num || board[x][col] === num) return false;
        const startRow = row - row % 3, startCol = col - col % 3;
        for (let i = 0; i < 3; i++)
            for (let j = 0; j < 3; j++)
                if (board[i + startRow][j + startCol] === num) return false;
        return true;
    }

    // Fonction solveSudoku CONSERV√âE avec la correction anti-blocage
    function solveSudoku(board, randomFunc, attempts = 0, limit = 50000) {
        if (attempts > limit) return false; 
        
        for (let i = 0; i < 9; i++) {
            for (let j = 0; j < 9; j++) {
                if (board[i][j] === 0) {
                    let nums = [1,2,3,4,5,6,7,8,9].sort(() => randomFunc() - 0.5);
                    for (let num of nums) {
                        if (isValid(board, i, j, num)) {
                            board[i][j] = num;
                            
                            if (solveSudoku(board, randomFunc, attempts + 1, limit)) return true; 
                            
                            board[i][j] = 0;
                        }
                    }
                    return false;
                }
            }
        }
        return true; 
    }

    function generateBoard(difficulty, seed = null) {
        let board = Array.from({ length: 9 }, () => Array(9).fill(0));
        
        let randomGenerator;
        if (seed !== null) {
            let currentSeed = seed;
            randomGenerator = () => seededRandom(currentSeed++);
        } else {
            randomGenerator = Math.random;
        }

        const result = solveSudoku(board, randomGenerator);
        if (!result) {
            console.error("√âchec critique : Le Sudoku n'a pas pu √™tre r√©solu.");
            return Array.from({ length: 9 }, () => Array(9).fill(0));
        }

        solution = board.map(row => [...row]); 

        let holes;
        switch(difficulty) {
            case 'easy': holes = 30; break;
            case 'medium': holes = 45; break;
            case 'hard': holes = 58; break; 
            default: holes = 30;
        }
        
        const rng = seed !== null ? (() => seededRandom(seed * 3 + 1234)) : Math.random;

        while (holes > 0) {
            let row = Math.floor(rng() * 9);
            let col = Math.floor(rng() * 9);
            if (board[row][col] !== 0) {
                board[row][col] = 0;
                holes--;
            }
        }
        return board;
    }

    // --- Fonctions de Sauvegarde et D√©marrage ---
    function saveGame() {
        const gameState = {
            solution: solution,
            initialBoard: initialBoard,
            currentBoard: currentBoard,
            mistakes: mistakes,
            hintsUsed: hintsUsed,
            isComplete: false,
            difficulty: null 
        };
        
        localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
        document.getElementById('btn-continue').style.display = 'block';
    }

    function continueGame() {
        const savedData = localStorage.getItem(SAVE_KEY);
        if (!savedData) return;

        const state = JSON.parse(savedData);
        solution = state.solution;
        initialBoard = state.initialBoard;
        currentBoard = state.currentBoard;
        mistakes = state.mistakes;
        hintsUsed = state.hintsUsed;
        
        setupGameScreen();
    }

    function setupGameScreen() {
        gameOver = false;
        selectedCellIndex = -1;

        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'flex';
        document.getElementById('modal').style.display = 'none';
        
        updateStatsUI();
        renderBoard();
        renderKeypad();
        updateKeypadStatus();
    }
    
    function startGame(diff) {
        localStorage.removeItem(SAVE_KEY);
        document.getElementById('btn-continue').style.display = 'none';

        mistakes = 0;
        hintsUsed = 0;
        let matrix = generateBoard(diff);
        initialBoard = matrix.flat(); 
        solution = solution.flat();
        currentBoard = [...initialBoard];
        
        setupGameScreen();
        saveGame();
    }
    
    function goToStartScreen() {
        gameOver = false;
        selectedCellIndex = -1;
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('start-screen').style.display = 'flex';
        document.getElementById('modal').style.display = 'none';
        
        if (localStorage.getItem(SAVE_KEY)) {
            document.getElementById('btn-continue').style.display = 'block';
        } else {
             document.getElementById('btn-continue').style.display = 'none';
        }
    }

    // --- Fonctions d'Interface et de Jeu ---
    function updateStatsUI() {
        document.getElementById('mistakes').textContent = `Erreurs: ${mistakes}/${maxMistakes}`;
        document.getElementById('hints').textContent = `Indice: ${hintsUsed}/${maxHints}`;
        document.getElementById('btn-hint').style.opacity = hintsUsed >= maxHints ? "0.5" : "1";
    }

    function renderBoard() {
        const boardDiv = document.getElementById('board');
        boardDiv.innerHTML = '';
        currentBoard.forEach((val, idx) => {
            let div = document.createElement('div');
            div.className = 'cell';
            div.id = `cell-${idx}`;
            
            if (initialBoard[idx] !== 0) {
                div.classList.add('fixed');
                div.textContent = emojis[val - 1];
            } else if (val !== 0) {
                div.textContent = emojis[val - 1];
            }
            
            div.onclick = () => selectCell(idx);
            boardDiv.appendChild(div);
        });
    }

    function renderKeypad() {
        const kp = document.getElementById('keypad');
        const deleteButtonHTML = `<div class="key delete" onclick="inputNumber(0)">Effacer</div>`;
        
        kp.innerHTML = ''; 
        emojis.forEach((emoji, idx) => {
            let btn = document.createElement('div');
            btn.className = 'key';
            btn.id = `key-${idx+1}`;
            btn.textContent = emoji;
            btn.onclick = (e) => { e.stopPropagation(); inputNumber(idx + 1); };
            kp.appendChild(btn);
        });
        
        kp.insertAdjacentHTML('beforeend', deleteButtonHTML);
    }

    function updateKeypadStatus() {
        let counts = Array(10).fill(0);
        currentBoard.forEach(val => {
            if (val !== 0) counts[val]++;
        });

        for (let i = 1; i <= 9; i++) {
            const btn = document.getElementById(`key-${i}`);
            if (btn) {
                if (counts[i] === 9) {
                    btn.classList.add('completed');
                } else {
                    btn.classList.remove('completed');
                }
            }
        }
    }

    function selectCell(idx) {
        if (gameOver) return;
        if (initialBoard[idx] !== 0) {
            if (selectedCellIndex !== -1) document.getElementById(`cell-${selectedCellIndex}`).classList.remove('selected');
            selectedCellIndex = -1; 
            return;
        }

        if (selectedCellIndex !== -1) document.getElementById(`cell-${selectedCellIndex}`).classList.remove('selected');
        selectedCellIndex = idx;
        document.getElementById(`cell-${idx}`).classList.add('selected');
    }

    function inputNumber(num) {
        if (gameOver || selectedCellIndex === -1 || initialBoard[selectedCellIndex] !== 0) return;

        let cell = document.getElementById(`cell-${selectedCellIndex}`);
        let correctVal = solution[selectedCellIndex];
        
        if (num === 0) { 
            currentBoard[selectedCellIndex] = 0;
            cell.textContent = '';
            cell.classList.remove('selected');
            selectedCellIndex = -1;
            saveGame();
            updateKeypadStatus();
            return;
        }

        if (num !== correctVal) {
            mistakes++;
            updateStatsUI();
            saveGame(); 

            cell.textContent = 'üòµ‚Äçüí´'; 
            cell.classList.add('error');
            
            setTimeout(() => {
                if (!gameOver) {
                    cell.classList.remove('error');
                    cell.textContent = currentBoard[selectedCellIndex] !== 0 
                                       ? emojis[currentBoard[selectedCellIndex] - 1] 
                                       : '';
                }
            }, 800);
            
            if (mistakes >= maxMistakes) endGame(false);
        } else {
            currentBoard[selectedCellIndex] = num;
            cell.textContent = emojis[num - 1];
            cell.classList.remove('selected');
            selectedCellIndex = -1;
            
            updateKeypadStatus();
            saveGame(); 
            checkWin();
        }
    }

    function useHint() {
        if (gameOver || hintsUsed >= maxHints) return;
        
        let targetIdx = selectedCellIndex;
        if (targetIdx === -1 || currentBoard[targetIdx] !== 0) {
           let emptyIndices = currentBoard.map((val, idx) => val === 0 ? idx : null).filter(val => val !== null && initialBoard[idx] === 0);
           if (emptyIndices.length === 0) return;
           targetIdx = emptyIndices[Math.floor(Math.random() * emptyIndices.length)];
           selectCell(targetIdx);
        }
        
        hintsUsed++;
        let correctVal = solution[targetIdx];
        currentBoard[targetIdx] = correctVal;
        let cell = document.getElementById(`cell-${targetIdx}`);
        cell.textContent = emojis[correctVal - 1];
        
        cell.style.transition = "all 0.3s";
        cell.style.transform = "scale(1.2)";
        cell.style.background = "rgba(0, 224, 255, 0.3)"; 
        setTimeout(() => {
             cell.style.transform = "scale(1)";
             cell.style.background = "";
             cell.classList.remove('selected');
             selectedCellIndex = -1;
             renderBoard(); 
        }, 300);

        updateStatsUI();
        updateKeypadStatus();
        saveGame();
        checkWin();
    }

    function checkWin() {
        if (!currentBoard.includes(0)) endGame(true);
    }

    function endGame(win) {
        gameOver = true;
        
        localStorage.removeItem(SAVE_KEY);
        document.getElementById('btn-continue').style.display = 'none';


        const modal = document.getElementById('modal');
        const title = document.getElementById('modal-title');
        const msg = document.getElementById('modal-msg');
        
        if (win) {
            const boardDiv = document.getElementById('board');
            boardDiv.classList.add('victory-animation'); 
            
            setTimeout(() => {
                boardDiv.classList.remove('victory-animation');
            }, 1500); 
        }

        setTimeout(() => {
            modal.style.display = 'flex';
            if (win) {
                title.innerHTML = "üéâ Victoire ! üéâ";
                msg.textContent = "Bravo, tu as r√©solu le Sudoku !";
            } else {
                title.innerHTML = "‚ò†Ô∏è Game Over ‚ò†Ô∏è";
                msg.textContent = "Tu as fait 3 erreurs. Retente ta chance !";
            }
        }, 500);
    }

    function shareOnFacebook() {
        let quote = "Joue au Sudoku de Totof !";
        
        const url = encodeURIComponent(window.location.href); 
        const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${encodeURIComponent(quote)}`;
        window.open(shareUrl, '_blank'); 
        return false;
    }

</script>

</body>
</html>
